<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout.html}" lang="en">
<head>
</head>
<body class="bg-dark text-white">

<div class="container-fluid text-white p-5" layout:fragment="content">
    <div class="container mt-5">
        <h2 class="text-center">ğŸ³ ì¬ë£Œ ë¦¬ìŠ¤íŠ¸</h2>
        <hr class="divider my-4"/>

        <!-- ë ˆì‹œí”¼ ì‘ì„± í¼ -->
        <form >
            <!-- ì¬ë£Œ ì…ë ¥ (ê²€ìƒ‰ ë²„íŠ¼ + ì¶”ê°€ ë²„íŠ¼ í•œ ì¤„ì— ì •ë ¬) -->
            <div class="form-group mb-4">

                <div class="d-flex align-items-center gap-2">
                    <input type="text" name="ingredients[0].ingredientName" placeholder="ì¬ë£Œëª… ì…ë ¥" class="form-control" style="max-width: 300px;" />

                    <button type="button" class="btn btn-secondary open-ingredient-modal">ì¬ë£Œ ê²€ìƒ‰</button>

                    <a th:href="@{/admin/ingredientinsert}">
                        <button type="button" class="btn btn-primary">ì¬ë£Œ ì¶”ê°€</button>
                    </a>
                </div>
            </div>

            <!-- ì¬ë£Œ ì¹´ë“œ ëª©ë¡ -->
            <div id="ingredientList" class="container">
                <div class="row row-cols-1 row-cols-md-4 g-4">
                    <div class="col" th:each="ingredient : ${ingredients}">
                        <div class="card ingredient-select" style="cursor: pointer;" data-name="${ingredient.ingredientName}">
                            <img th:src="${ingredient.imageUrl}" class="card-img-top" alt="ì´ë¯¸ì§€" style="height: 130px; object-fit: cover;">
                            <div class="card-body p-2 text-center" style="background-color: #f8f9fa; color: #000;">
                                <p th:text="${ingredient.ingredientName != null and !ingredient.ingredientName.isEmpty() ? ingredient.ingredientName : 'ì´ë¦„ ì—†ìŒ'}">ì´ë¦„</p>
                                <p th:text="${ingredient.detail}">ìƒì„¸ ì •ë³´</p>
                                <p th:text="${ingredient.price != null ? ingredient.price.toString() + 'ì›' : 'ê°€ê²© ì—†ìŒ'}">ê°€ê²©</p>

                                <a th:href="@{/admin/ingredient/edit/{id}(id=${ingredient.id})}" class="btn btn-primary btn-sm mt-2">ìˆ˜ì •</a>
                                <a th:href="@{/admin/ingredient/delete/{id}(id=${ingredient.id})}" class="btn btn-danger btn-sm mt-2 ms-1">ì‚­ì œ</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <script th:inline="javascript">
                const ingredients = [[${ingredients}]];  // ì„œë²„ì—ì„œ ì „ì²´ ì¬ë£Œ ëª©ë¡ ê°€ì ¸ì˜¨ ê±°

                $(document).ready(function() {
                    $('.open-ingredient-modal').click(function() {
                        const searchName = $('input[name="ingredients[0].ingredientName"]').val().toLowerCase();
                        const filteredIngredients = ingredients.filter(ing => ing.ingredientName.toLowerCase().includes(searchName));

                        // ê¸°ì¡´ ì¬ë£Œ ì¹´ë“œ ì‚­ì œ
                        $('#ingredientList .row').empty();

                        // í•„í„°ëœ ì¬ë£Œë§Œ ë‹¤ì‹œ ì¶”ê°€
                        filteredIngredients.forEach(ingredient => {
                            const card = `
                    <div class="col mb-4">
                        <div class="card ingredient-select" style="cursor: pointer;" data-name="${ingredient.ingredientName}">
                            <img src="${ingredient.imageUrl}" class="card-img-top" alt="ì´ë¯¸ì§€" style="height: 130px; object-fit: cover;">
                            <div class="card-body p-2 text-center" style="background-color: #f8f9fa; color: #000;">
                                <p>${ingredient.ingredientName}</p>
                                <p>${ingredient.detail}</p>
                                <p>${ingredient.price != null ? ingredient.price.toLocaleString() + 'ì›' : 'ê°€ê²© ì—†ìŒ'}</p>

                                <!-- ìˆ˜ì • ë° ì‚­ì œ ë²„íŠ¼ ì¶”ê°€ -->
                                <a href="/admin/ingredient/edit/${ingredient.id}" class="btn btn-primary btn-sm mt-2">ìˆ˜ì •</a>
                                <a href="/admin/ingredient/delete/${ingredient.id}" class="btn btn-danger btn-sm mt-2 ms-1">ì‚­ì œ</a>
                            </div>
                        </div>
                    </div>
                `;
                            $('#ingredientList .row').append(card);
                        });
                    });
                });
            </script>


        </form>

    </div>
</div>

<script th:inline="javascript">
    const ingredients = [[${ingredients}]];  // ì„œë²„ì—ì„œ ì¬ë£Œ ëª©ë¡ì„ ì „ë‹¬ë°›ìŒ
</script>

<!-- Bootstrap ë° jQuery JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>



</body>
</html>
